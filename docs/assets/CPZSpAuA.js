const c=async()=>{const n={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,hardwareConcurrency:navigator.hardwareConcurrency||1,maxTouchPoints:navigator.maxTouchPoints||0,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack};try{const t=document.createElement("canvas"),e=t.getContext("2d");e&&(e.textBaseline="top",e.font="14px Arial",e.fillText("Device fingerprint test 🎮",2,2),n.canvas=t.toDataURL())}catch(t){console.warn("Canvas指纹生成失败:",t)}try{const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(e){const r=e.getExtension("WEBGL_debug_renderer_info");if(r&&r.UNMASKED_VENDOR_WEBGL&&r.UNMASKED_RENDERER_WEBGL)try{const a=e.getParameter(r.UNMASKED_VENDOR_WEBGL),o=e.getParameter(r.UNMASKED_RENDERER_WEBGL);n.webgl=`${a}|${o}`}catch{n.webgl=`WebGL-${e.getParameter(e.VERSION)||"unknown"}`}else n.webgl=`WebGL-${e.getParameter(e.VERSION)||"basic"}`}}catch(t){console.warn("WebGL指纹生成失败:",t)}return n},s=n=>{const t=JSON.stringify(n,Object.keys(n).sort());let e=0;for(let r=0;r<t.length;r++){const a=t.charCodeAt(r);e=(e<<5)-e+a,e=e&e}return Math.abs(e).toString(36)},i=async()=>{try{const n=localStorage.getItem("device_id");if(n)return console.log("使用已存储的设备ID:",n),n;const t=await c(),e=s(t),r=Date.now(),a=`device-${e}-${r.toString(36)}`;return localStorage.setItem("device_id",a),localStorage.setItem("device_id_created",r.toString()),console.log("生成新的设备ID:",a),a}catch(n){console.error("生成设备ID失败，使用回退方案:",n);const t=`fallback-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return localStorage.setItem("device_id",t),t}},g=async()=>{const n=await i(),t=Math.random().toString(36).substr(2,6);return`player-${n.split("-")[1]}-${t}`};export{i as generateDeviceId,g as generateUniquePlayerId};
