const o=async()=>{const t={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,hardwareConcurrency:navigator.hardwareConcurrency||1,maxTouchPoints:navigator.maxTouchPoints||0,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack};try{const r=document.createElement("canvas"),e=r.getContext("2d");e&&(e.textBaseline="top",e.font="14px Arial",e.fillText("Device fingerprint test 🎮",2,2),t.canvas=r.toDataURL())}catch(r){console.warn("Canvas指纹生成失败:",r)}try{const r=document.createElement("canvas"),e=r.getContext("webgl")||r.getContext("experimental-webgl");if(e){const n=e.getExtension("WEBGL_debug_renderer_info");if(n&&n.UNMASKED_VENDOR_WEBGL&&n.UNMASKED_RENDERER_WEBGL)try{const a=e.getParameter(n.UNMASKED_VENDOR_WEBGL),s=e.getParameter(n.UNMASKED_RENDERER_WEBGL);t.webgl=`${a}|${s}`}catch{t.webgl=`WebGL-${e.getParameter(e.VERSION)||"unknown"}`}else t.webgl=`WebGL-${e.getParameter(e.VERSION)||"basic"}`}}catch(r){console.warn("WebGL指纹生成失败:",r)}return t},i=t=>{const r=JSON.stringify(t,Object.keys(t).sort());let e=0;for(let n=0;n<r.length;n++){const a=r.charCodeAt(n);e=(e<<5)-e+a,e=e&e}return Math.abs(e).toString(36)},c=async()=>{try{const t=localStorage.getItem("device_id");if(t)return console.log("使用已存储的设备ID:",t),t;const r=await o(),e=i(r),n=Date.now(),a=`device-${e}-${n.toString(36)}`;return localStorage.setItem("device_id",a),localStorage.setItem("device_id_created",n.toString()),console.log("生成新的设备ID:",a),a}catch(t){console.error("生成设备ID失败，使用回退方案:",t);const r=`fallback-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return localStorage.setItem("device_id",r),r}},g=async()=>{const t=await c(),r=Math.random().toString(36).substr(2,6);return`player-${t.split("-")[1]}-${r}`},l=async()=>{const t=await o();return{deviceId:await c(),fingerprint:{userAgent:t.userAgent.substring(0,50)+"...",platform:t.platform,screen:t.screen,timezone:t.timezone,cores:t.hardwareConcurrency},created:localStorage.getItem("device_id_created")}};export{c as generateDeviceId,g as generateUniquePlayerId,l as getDeviceInfo};
