import{d as M,W as z,k as u,y as a,z as r,A as e,G as v,C as y,M as j,I as f,H as s,B as d,J as T,K as U,L as ee,_ as te,r as B,O as D,o as G,a1 as se,Y as oe,Z as ne,a0 as re,a4 as ae,a5 as ce,V as ie,N as le,q as N,e as de,X as ue,E as w,R as me}from"#entry";const ye={class:"flex items-center space-x-2 text-sm"},ge={class:"flex items-center space-x-1"},pe={key:0,class:"flex items-center space-x-1"},he={class:"network-indicator"},_e={key:0,class:"text-xs text-gray-500"},xe=M({__name:"NetworkStatusIndicator",setup(H){const $=z(),o=u(()=>$.status),c=u(()=>$.latency),i=u(()=>$.quality),p=u(()=>{switch(o.value){case"connected":return"已连接";case"connecting":return"连接中";case"reconnecting":return"重连中";case"disconnected":return"已断开";default:return"未连接"}}),b=u(()=>{switch(o.value){case"connected":return"wifi";case"connecting":case"reconnecting":return"spinner";case"disconnected":return"alert-circle";default:return"signal"}}),k=u(()=>{switch(o.value){case"connected":return"text-green-500";case"connecting":case"reconnecting":return"text-yellow-500 animate-spin";case"disconnected":return"text-red-500";default:return"text-gray-400"}}),g=u(()=>{switch(o.value){case"connected":return"text-green-600";case"connecting":case"reconnecting":return"text-yellow-600";case"disconnected":return"text-red-600";default:return"text-gray-500"}}),l=u(()=>{switch(i.value){case"excellent":return 4;case"good":return 3;case"fair":return 2;case"poor":return 1;default:return 0}}),h=u(()=>{switch(i.value){case"excellent":return"bg-green-500";case"good":return"bg-blue-500";case"fair":return"bg-yellow-500";case"poor":return"bg-red-500";default:return"bg-gray-300"}}),_=u(()=>o.value==="connected"),m=u(()=>o.value==="connected"&&c.value>0);return(L,R)=>{const I=j;return r(),a("div",ye,[e("div",ge,[y(I,{name:s(b),class:f(["w-4 h-4",s(k)])},null,8,["name","class"]),e("span",{class:f(s(g))},d(s(p)),3)]),s(_)?(r(),a("div",pe,[e("div",he,[(r(),a(T,null,U(4,S=>e("div",{key:S,class:f(["signal-bar",S<=s(l)?"active":"",s(h)]),style:ee({height:`${4+S*2}px`})},null,6)),64))]),s(m)?(r(),a("span",_e,d(s(c))+"ms ",1)):v("",!0)])):v("",!0)])}}}),fe=te(xe,[["__scopeId","data-v-7b530dce"]]),be={class:"flex items-center justify-between p-4 bg-white border border-gray-200 rounded-lg"},ve={class:"flex items-center space-x-3"},we={class:"relative"},ke={class:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold"},$e={key:0,class:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center"},Ce={class:"flex-1 min-w-0"},Ie={class:"flex items-center space-x-2"},Se={class:"font-medium text-gray-900 truncate"},He={key:0,class:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full"},Re={key:1,class:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full"},Ne={class:"flex items-center mt-1"},Te={key:0,class:"flex-shrink-0"},Ue=M({__name:"PlayerCard",props:{player:{},isHost:{type:Boolean},isCurrentUser:{type:Boolean},canKick:{type:Boolean}},emits:["kick-player"],setup(H){const $=o=>o.charAt(0).toUpperCase();return(o,c)=>{const i=j;return r(),a("div",be,[e("div",ve,[e("div",we,[e("div",ke,d($(o.player.name)),1),o.isHost?(r(),a("div",$e,[y(i,{name:"star",class:"w-2.5 h-2.5 text-white"})])):v("",!0),e("div",{class:f(["absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white",o.player.isOnline?"bg-green-500":"bg-gray-400"])},null,2)]),e("div",Ce,[e("div",Ie,[e("h3",Se,d(o.player.name),1),o.isCurrentUser?(r(),a("span",He," 你 ")):v("",!0),o.isHost?(r(),a("span",Re," 房主 ")):v("",!0)]),e("div",Ne,[y(i,{name:o.player.isReady?"check-circle":"clock",class:f(["w-4 h-4 mr-1",o.player.isReady?"text-green-500":"text-yellow-500"])},null,8,["name","class"]),e("span",{class:f(["text-sm",o.player.isReady?"text-green-600":"text-yellow-600"])},d(o.player.isReady?"已准备":"准备中"),3)])])]),o.canKick?(r(),a("div",Te,[e("button",{onClick:c[0]||(c[0]=p=>o.$emit("kick-player",o.player.id)),class:"p-2 text-gray-400 hover:text-red-500 transition-colors",title:"踢出玩家"},[y(i,{name:"x",class:"w-4 h-4"})])])):v("",!0)])}}}),Be={class:"flex flex-col h-full"},Me={class:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50"},je={key:0,class:"text-center w-full"},Pe={class:"inline-block px-3 py-1 text-xs bg-gray-200 text-gray-600 rounded-full"},De={key:0,class:"text-xs text-gray-500 mb-1"},Ge={class:"text-sm"},Le={key:0,class:"text-center text-gray-500 py-8"},qe={class:"border-t border-gray-200 p-4"},Ve=["disabled"],ze=["disabled"],Ke=M({__name:"ChatBox",props:{messages:{},currentUserId:{}},emits:["send-message"],setup(H,{emit:$}){const o=H,c=$,i=B(""),p=B(!1),b=async()=>{const l=i.value.trim();if(!(!l||p.value)){p.value=!0;try{await c("send-message",l),i.value=""}catch(h){console.error("发送消息失败:",h)}finally{p.value=!1}}},k=l=>{const h=new Date(l),_=new Date;return h.toDateString()===_.toDateString()?h.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):h.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},g=()=>{ae(()=>{const l=document.querySelector(".overflow-y-auto");l&&(l.scrollTop=l.scrollHeight)})};return D(()=>o.messages.length,()=>{g()}),G(()=>{g()}),(l,h)=>{const _=j;return r(),a("div",Be,[e("div",Me,[(r(!0),a(T,null,U(l.messages,m=>(r(),a("div",{key:m.id,class:f(["flex",m.playerId===l.currentUserId?"justify-end":"justify-start"])},[m.type==="system"?(r(),a("div",je,[e("span",Pe,d(m.message),1)])):(r(),a("div",{key:1,class:f(["max-w-xs lg:max-w-md px-3 py-2 rounded-lg",m.playerId===l.currentUserId?"bg-primary-500 text-white":"bg-white border border-gray-200"])},[m.playerId!==l.currentUserId?(r(),a("div",De,d(m.playerName),1)):v("",!0),e("div",Ge,d(m.message),1),e("div",{class:f(["text-xs mt-1",m.playerId===l.currentUserId?"text-primary-100":"text-gray-400"])},d(k(m.timestamp)),3)],2))],2))),128)),l.messages.length===0?(r(),a("div",Le,[y(_,{name:"chat",class:"w-8 h-8 mx-auto mb-2 text-gray-300"}),h[1]||(h[1]=e("p",{class:"text-sm"},"暂无消息",-1))])):v("",!0)]),e("div",qe,[e("form",{onSubmit:se(b,["prevent"]),class:"flex space-x-2"},[oe(e("input",{"onUpdate:modelValue":h[0]||(h[0]=m=>re(i)?i.value=m:null),type:"text",placeholder:"输入消息...",maxlength:"200",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:s(p)},null,8,Ve),[[ne,s(i)]]),e("button",{type:"submit",disabled:!s(i).trim()||s(p),class:"btn btn-primary px-4"},[y(_,{name:s(p)?"spinner":"send",class:f(["w-4 h-4",{"animate-spin":s(p)}])},null,8,["name","class"])],8,ze)],32)])])}}}),Ae={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100"},Ee={class:"bg-white shadow-sm border-b"},Oe={class:"max-w-4xl mx-auto px-4 py-4"},Fe={class:"flex items-center justify-between"},Je={class:"text-center"},Qe={class:"text-xl font-semibold text-gray-800"},We={class:"max-w-4xl mx-auto px-4 py-8"},Xe={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Ye={class:"lg:col-span-2 space-y-6"},Ze={class:"card"},et={class:"card-header flex items-center justify-between"},tt={class:"text-lg font-semibold flex items-center"},st={class:"flex items-center space-x-2"},ot={class:"card-body"},nt={class:"space-y-4"},rt={class:"text-center"},at={class:"room-code inline-block"},ct={class:"mt-2 space-x-2"},it={class:"grid grid-cols-2 gap-4 text-sm"},lt={class:"flex justify-between"},dt={class:"font-medium"},ut={class:"flex justify-between"},mt={class:"font-medium"},yt={class:"flex justify-between"},gt={class:"card"},pt={class:"card-header"},ht={class:"text-lg font-semibold flex items-center"},_t={class:"card-body"},xt={class:"space-y-3"},ft={class:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center mr-3"},bt={class:"space-y-6"},vt={class:"card"},wt={class:"card-header"},kt={class:"text-lg font-semibold flex items-center"},$t={class:"card-body p-0"},Ct={class:"card"},It={class:"card-body space-y-4"},St={key:0,class:"text-xs text-gray-500 p-2 bg-gray-100 rounded"},Ht={key:1,class:"text-center"},Rt=["disabled"],Nt=["disabled"],Tt={key:2,class:"space-y-3"},Ut=["disabled"],Bt={class:"text-sm text-gray-600 text-center space-y-1"},Mt={key:0,class:"text-green-600 font-medium"},jt={key:1,class:"text-orange-600"},Pt={key:2},Dt={class:"pt-4 border-t border-gray-200"},Lt=M({__name:"[code]",setup(H){const o=ce().params.code,c=ie(),i=le(),p=z(),b=B(!1),k=B(!1),g=u(()=>c.players),l=u(()=>c.hostPlayer),h=u(()=>c.currentUser),_=u(()=>i.playerId),m=u(()=>{const n=_.value&&l.value&&_.value===l.value.id,t=c.isHost;return console.log("房间页面 - isHost判断:",{currentUserId:_.value,hostId:l.value?.id,isHostByUserId:n,storeIsHost:t,finalResult:n||t}),n||t}),L=u(()=>c.chatMessages),R=u(()=>p.latency),I=u(()=>g.value.length<3?"waiting":g.value.filter(t=>!t.isHost).every(t=>t.isReady)?"ready":"preparing"),S=u(()=>{switch(I.value){case"waiting":return"等待玩家";case"ready":return"准备就绪";case"preparing":return"准备中";default:return"未知状态"}}),P=u(()=>c.canStartGame),K=u(()=>{const n=g.value.filter(t=>!t.isHost).length;return console.log("非房主玩家数量:",n,"所有玩家:",g.value.map(t=>({id:t.id,name:t.name,isHost:t.isHost}))),n}),A=u(()=>{const n=g.value.filter(t=>!t.isHost&&t.isReady).length;return console.log("已准备的非房主玩家数量:",n),n}),E=u(()=>!1),q=async()=>{if(!b.value){b.value=!0;try{await c.toggleReady()}catch(n){console.error("切换准备状态失败:",n),i.showNotification({type:"error",title:"操作失败",message:"无法切换准备状态，请重试"})}finally{b.value=!1}}},O=async()=>{if(!(!P.value||k.value)){k.value=!0;try{await c.startGame(),await N("/game")}catch(n){console.error("开始游戏失败:",n),i.showNotification({type:"error",title:"启动失败",message:"无法开始游戏，请重试"})}finally{k.value=!1}}},V=async()=>{if(await i.showConfirmDialog({title:"确认离开",message:"确定要离开房间吗？",confirmText:"离开",cancelText:"取消"}))try{await c.leaveRoom(),await N("/")}catch(t){console.error("离开房间失败:",t)}},F=async n=>{if(await i.showConfirmDialog({title:"确认踢出",message:"确定要踢出该玩家吗？",confirmText:"踢出",cancelText:"取消"}))try{await c.kickPlayer(n)}catch(x){console.error("踢出玩家失败:",x),i.showNotification({type:"error",title:"操作失败",message:"无法踢出玩家，请重试"})}},J=async n=>{try{await c.sendChatMessage(n)}catch(t){console.error("发送消息失败:",t)}},Q=async()=>{try{await navigator.clipboard.writeText(o),i.showNotification({type:"success",title:"复制成功",message:"房间码已复制到剪贴板"})}catch(n){console.error("复制失败:",n)}},W=async()=>{const n=`${window.location.origin}/room/${o}`;if(navigator.share)try{await navigator.share({title:"斗地主游戏邀请",text:`来和我一起玩斗地主吧！房间码: ${o}`,url:n})}catch{}else try{await navigator.clipboard.writeText(n),i.showNotification({type:"success",title:"链接已复制",message:"房间链接已复制到剪贴板"})}catch(t){console.error("复制链接失败:",t)}};return G(async()=>{try{await c.joinRoom(o),p.startMonitoring()}catch(n){console.error("加入房间失败:",n),i.showNotification({type:"error",title:"加入失败",message:"无法加入房间，可能房间不存在或已满员"}),await N("/")}}),de(()=>{p.stopMonitoring()}),D(()=>c.gameStarted,n=>{n&&N("/game")}),D(()=>g.value.length,(n,t)=>{t&&n<t&&i.showNotification({type:"info",title:"玩家离开",message:"有玩家离开了房间"})}),G(()=>{console.log("房间页面挂载完成"),console.log("roomStore.isHost:",c.isHost),console.log("roomStore.currentUserId:",c.currentUserId),console.log("roomStore.players:",c.players)}),ue({title:`斗地主网游 - 房间 ${o}`,description:"等待玩家加入，准备开始斗地主游戏",robots:"noindex, nofollow"}),(n,t)=>{const x=j,X=fe,Y=Ue,Z=Ke;return r(),a("div",Ae,[e("header",Ee,[e("div",Oe,[e("div",Fe,[e("button",{onClick:V,class:"btn btn-secondary flex items-center"},[y(x,{name:"arrow-left",class:"w-4 h-4 mr-2"}),t[0]||(t[0]=w(" 返回大厅 ",-1))]),e("div",Je,[e("h1",Qe," 房间 "+d(s(o)),1),y(X)]),t[1]||(t[1]=e("div",{class:"w-20"},null,-1))])])]),e("main",We,[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("div",et,[e("h2",tt,[y(x,{name:"home",class:"w-5 h-5 mr-2"}),t[2]||(t[2]=w(" 房间信息 ",-1))]),e("div",st,[e("span",{class:f(["px-2 py-1 rounded-full text-xs font-medium",s(I)==="waiting"?"bg-yellow-100 text-yellow-800":s(I)==="ready"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},d(s(S)),3)])]),e("div",ot,[e("div",nt,[e("div",rt,[e("div",at,d(s(o)),1),e("div",ct,[e("button",{onClick:Q,class:"btn btn-sm btn-secondary"},[y(x,{name:"copy",class:"w-4 h-4 mr-1"}),t[3]||(t[3]=w(" 复制房间码 ",-1))]),e("button",{onClick:W,class:"btn btn-sm btn-secondary"},[y(x,{name:"share",class:"w-4 h-4 mr-1"}),t[4]||(t[4]=w(" 分享链接 ",-1))])])]),e("div",it,[e("div",lt,[t[5]||(t[5]=e("span",{class:"text-gray-600"},"房主:",-1)),e("span",dt,d(s(l)?.name||"未知"),1)]),e("div",ut,[t[6]||(t[6]=e("span",{class:"text-gray-600"},"玩家数:",-1)),e("span",mt,d(s(g).length)+"/3",1)]),t[8]||(t[8]=e("div",{class:"flex justify-between"},[e("span",{class:"text-gray-600"},"游戏模式:"),e("span",{class:"font-medium"},"经典斗地主")],-1)),e("div",yt,[t[7]||(t[7]=e("span",{class:"text-gray-600"},"网络延迟:",-1)),e("span",{class:f(["font-medium",s(R)<50?"text-green-600":s(R)<100?"text-yellow-600":"text-red-600"])},d(s(R))+"ms ",3)])])])])]),e("div",gt,[e("div",pt,[e("h2",ht,[y(x,{name:"users",class:"w-5 h-5 mr-2"}),t[9]||(t[9]=w(" 玩家列表 ",-1))])]),e("div",_t,[e("div",xt,[(r(!0),a(T,null,U(s(g),C=>(r(),me(Y,{key:C.id,player:C,"is-host":C.id===s(l)?.id,"is-current-user":C.id===s(_),"can-kick":s(m)&&C.id!==s(_),onKickPlayer:F},null,8,["player","is-host","is-current-user","can-kick"]))),128)),(r(!0),a(T,null,U(3-s(g).length,C=>(r(),a("div",{key:`empty-${C}`,class:"flex items-center p-4 border-2 border-dashed border-gray-300 rounded-lg"},[e("div",ft,[y(x,{name:"user-plus",class:"w-5 h-5 text-gray-400"})]),t[10]||(t[10]=e("span",{class:"text-gray-500"},"等待玩家加入...",-1))]))),128))])])])]),e("div",bt,[e("div",vt,[e("div",wt,[e("h3",kt,[y(x,{name:"chat",class:"w-5 h-5 mr-2"}),t[11]||(t[11]=w(" 聊天室 ",-1))])]),e("div",$t,[y(Z,{messages:s(L),"current-user-id":s(_),onSendMessage:J,class:"h-64"},null,8,["messages","current-user-id"])])]),e("div",Ct,[t[14]||(t[14]=e("div",{class:"card-header"},[e("h3",{class:"text-lg font-semibold"},"游戏控制")],-1)),e("div",It,[s(E)?(r(),a("div",St," 调试: isHost="+d(s(m))+", currentUserId="+d(s(_))+", hostId="+d(s(l)?.id),1)):v("",!0),s(m)?v("",!0):(r(),a("div",Ht,[s(h)?.isReady?(r(),a("button",{key:1,onClick:q,disabled:s(b),class:"btn btn-secondary btn-lg w-full"},[y(x,{name:"x",class:"w-5 h-5 mr-2"}),w(" "+d(s(b)?"取消中...":"取消准备"),1)],8,Nt)):(r(),a("button",{key:0,onClick:q,disabled:s(b),class:"btn btn-success btn-lg w-full"},[y(x,{name:"check",class:"w-5 h-5 mr-2"}),w(" "+d(s(b)?"准备中...":"准备"),1)],8,Rt))])),s(m)?(r(),a("div",Tt,[e("button",{onClick:O,disabled:!s(P)||s(k),class:"btn btn-primary btn-lg w-full"},[y(x,{name:"play",class:"w-5 h-5 mr-2"}),w(" "+d(s(k)?"启动中...":"开始游戏"),1)],8,Ut),e("div",Bt,[s(P)?(r(),a("p",Mt," ✅ 所有玩家已准备，可以开始游戏 ")):s(g).length<3?(r(),a("p",jt," 👥 等待玩家加入 ("+d(s(g).length)+"/3) ",1)):(r(),a("p",Pt," ⏳ 等待其他玩家准备 ("+d(s(A))+"/"+d(s(K))+") ",1)),t[12]||(t[12]=e("p",{class:"text-xs text-gray-500"}," 房主无需准备，等待其他玩家即可 ",-1))])])):v("",!0),e("div",Dt,[e("button",{onClick:V,class:"btn btn-danger w-full"},[y(x,{name:"door-open",class:"w-5 h-5 mr-2"}),t[13]||(t[13]=w(" 离开房间 ",-1))])])])])])])])])}}});export{Lt as default};
